#!/bin/sh

NORMALDIR="$1"
EARLYDIR="$2"
LATEDIR="$3"

ACTIVESLOT="$(sed 's/.*rauc\.slot=\([AB]\).*/\1/' /proc/cmdline)"

if [ "$ACTIVESLOT" = "A" ]; then
	desc="A"
	what=/dev/mmcblk0p6
else
	desc="B"
	what=/dev/mmcblk0p7
fi

# cat with here-document not possible due to /tmp being ro
script=$0
echo "# auto-generated by $script
[Unit]
Description=Log File System ($desc)

[Mount]
What=$what
Where=/var/log" > "$NORMALDIR/var-log.mount"

mkdir -p "$NORMALDIR/sysinit.target.wants"
ln -s ../var-log.mount "$NORMALDIR/sysinit.target.wants"
